<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>체크리스트 테이블 - 준수여부 버전</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* 전역 폰트 및 레이아웃 */
    body { font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; font-size:12px; background-color:#f7f7f7; }
    .container-1200 { max-width:1200px; margin-left:auto; margin-right:auto; }
    .primary-blue { background-color: #337AB7; }
    .primary-blue:hover { background-color: #2868A3; }
  /* 테이블 스타일 - 이미지와 유사한 컴팩트한 스타일링 */
  table { table-layout: fixed; }
  table th, table td { font-size:12px; padding:8px 10px; vertical-align:middle; }
  thead th:first-child, tbody td:first-child,
  thead th:nth-child(2), tbody td:nth-child(2),
  thead th:nth-child(3), tbody td:nth-child(3) { font-size:12px; }
  tbody td:first-child * , tbody td:nth-child(2) * , tbody td:nth-child(3) * { font-size:12px !important; }
  thead th { background:#f3f4f6; border-bottom:1px solid #e5e7eb; text-transform:none; color:#374151; font-weight:600; }
  tbody tr { background:#fff; }
  tbody tr + tr { border-top:1px solid #eef2f6; }
  .cell-truncate { overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }
  td[data-role="question"] .leading-relaxed { display:-webkit-box; -webkit-line-clamp:2; line-clamp:2; -webkit-box-orient:vertical; overflow:hidden; }
  /* (완료예정일 컬럼 제거 예정) */
  /* 개선사항 박스 최소 높이 더 작게 */
  .improve-box { min-height:40px; }
  .improvement-button-wrap { padding-top:4px; padding-bottom:4px; display:flex; justify-content:flex-end; }
  /* Reduce horizontal padding around the improvement button to remove extra space */
  td:nth-child(7) { padding-left:6px !important; padding-right:6px !important; }
  .improvement-button-wrap { padding:0; margin:0; }
  .improve-box .mt-2 { margin-top:6px; padding:0; display:flex; justify-content:flex-end; }
  .improvement-open-btn, .improvement-edit-btn { margin:0; }
  /* Center the improvement button vertically in the row */
  td:nth-child(7) .improvement-button-wrap { justify-content:center !important; }
  td:nth-child(7) .improvement-open-btn { padding-left:10px; padding-right:10px; }
  /* Prevent approval feedback text overflow */
  td:nth-child(6) { overflow-wrap: anywhere; word-break: break-word; }
  td:nth-child(6) .toggle-on-no p { margin:0; }
  /* (완료예정일 컬럼을 제거하므로 관련 스타일 제거) */
  /* 버튼/페이징 작게 보여주기 */
  #submit-all { font-size:12px; padding:6px 12px; }
  /* 필터/탭 영역 모사(선택적) */
  .filter-row { background:#fff; padding:10px; border-bottom:1px solid #e5e7eb; margin-bottom:8px; }
  /* 글로벌 오버라이드: 기존 유틸리티로 설정한 큰 패딩/최소높이 줄이기 */
  table th, table td { padding-top:6px !important; padding-bottom:6px !important; }
  [class*="min-h-"] { min-height:40px !important; }
  .pl-2.py-1 { padding-top:6px !important; padding-bottom:6px !important; }
  /* Halve px-3 and py-2 utility paddings for a more compact table */
  .px-3 { padding-left:0.1875rem !important; padding-right:0.1875rem !important; }
  .py-2 { padding-top:0.25rem !important; padding-bottom:0.25rem !important; }
  </style>
</head>
<body class="min-h-screen p-6">
  <div class="container-1200">
    <div class="bg-white rounded-lg shadow-sm overflow-hidden">
      <div class="overflow-x-auto" style="-webkit-overflow-scrolling: touch;">
        <table class="w-full min-w-[1200px]" style="table-layout: fixed;">
          <thead class="table-header">
            <tr>
              <th class="px-4 py-2 text-left font-bold text-gray-800 cell-truncate" style="width: 70px;">대분류</th>
              <th class="px-4 py-2 text-left font-bold text-gray-800 cell-truncate" style="width: 90px;">소분류</th>
              <th class="px-4 py-2 text-left font-bold text-gray-800" style="width: 240px;">질문</th>
              <th class="px-4 py-2 text-center font-bold text-gray-800 cell-truncate" style="width: 90px;">준수 여부</th>
              <th class="px-4 py-2 text-left font-bold text-gray-800 cell-truncate" style="width: 220px;">미흡사항</th>
              <th class="px-4 py-2 text-left font-bold text-gray-800 cell-truncate" style="width: 260px;">① 승인자 피드백</th>
              <th class="px-4 py-2 text-left font-bold text-gray-800" style="width: 260px;">② 개선사항 작성</th>
            </tr>
          </thead>
          <tbody>
            <!-- Row 1 -->
            <tr class="table-row hover:bg-gray-50 transition-colors" data-row-id="r1">
              <td class="px-4 py-2 text-gray-800 cell-truncate" style="font-size: 12px;"><div class="truncate" title="1. 보험설계사관리 부문">1. 보험설계사관리 부문</div></td>
              <td class="px-4 py-2 text-gray-800 cell-truncate" style="font-size: 12px;"><div class="truncate" title="(1) 위·해촉기준 설명 등">(1) 위·해촉기준 설명 등</div></td>
              <td class="px-4 py-2 text-gray-800" data-role="question" style="font-size: 12px;"><div class="leading-relaxed cursor-pointer">지점에 소속된 모든 보험설계사에게 위촉, 해촉 기준을 설명하고 교부된 위촉계약서의 이해 여부를 확인하고 있는가?</div></td>
              <td class="px-4 py-2 text-gray-800 text-center cell-truncate" style="font-size: 12px;"><span class="inline-flex items-center px-3 py-1 rounded font-medium" style="background-color: #FFE6E6; color: #D32F2F; border: 1px solid #FFCDD2; font-size: 12px;">아니오</span></td>
              <td class="px-3 py-2"><div class="text-gray-800" style="font-size:12px;">위해촉 기준을 재대로 안내하지 않음</div></td>
              <td class="px-3 py-2">
                <div class="pl-2 py-1 border-l-4 border-orange-400 bg-orange-50 toggle-on-no">
                  <div class="text-gray-700 mb-1" style="font-size: 12px;">김세현 차장 <span class="text-gray-500">(2025/05/13)</span></div>
                  <p class="text-gray-800 leading-relaxed" style="font-size: 12px;">신규 위촉 시 보험설계사와 면담을 필수로 진행하세요.</p>
                </div>
                <div class="text-gray-500 toggle-on-yes hidden" style="font-size: 12px;">해당 없음</div>
              </td>
              <td class="px-3 py-2">
                <div class="py-1 improve-box border-l-4 border-gray-200 bg-gray-50 toggle-on-no">
                  <div class="mt-2 flex justify-center">
                    <button class="px-3 py-1.5 primary-blue text-white rounded text-xs improvement-open-btn" data-target="details-r1">작성/확인</button>
                  </div>
                </div>
                <div class="text-gray-500 toggle-on-yes hidden" style="font-size: 12px;">해당 없음</div>
              </td>
              <!-- 작성/확인 버튼은 개선사항 셀로 이동했습니다. -->
            </tr>
            <!-- Row 1 details -->
            <tr id="details-r1" class="hidden" aria-hidden="true">
              <td colspan="7" class="bg-blue-50 px-4 py-4">
                <div class="space-y-3 details-content"></div>
              </td>
            </tr>

            <!-- Row 2 -->
            <tr class="table-row hover:bg-gray-50 transition-colors" data-row-id="r2">
              <td class="px-4 py-4 text-gray-800 cell-truncate" style="font-size: 12px;"><div class="truncate" title="1. 보험설계사관리 부문">1. 보험설계사관리 부문</div></td>
              <td class="px-4 py-4 text-gray-800 cell-truncate" style="font-size: 12px;"><div class="truncate" title="(2) 모집경력조회 등">(2) 모집경력조회 등</div></td>
              <td class="px-4 py-4 text-gray-800" data-role="question" style="font-size: 12px;"><div class="leading-relaxed cursor-pointer">신규 모집인 위촉 전 금융소비자보호 교육을 실시하고 이수 여부를 검증하고 있는가?</div></td>
              <td class="px-4 py-4 text-gray-800 text-center cell-truncate" style="font-size: 12px;"><span class="inline-flex items-center px-3 py-1 rounded font-medium" style="background-color: #E8F5E8; color: #2E7D32; border: 1px solid #C8E6C9; font-size: 12px;">예</span></td>
              <td class="px-3 py-2"><div class="text-gray-800" style="font-size:12px;">위해촉 기준을 재대로 안내하지 않음</div></td>
              <td class="px-3 py-2">
                <div class="pl-2 py-1 border-l-4 border-orange-400 bg-orange-50 toggle-on-no">
                  <div class="text-gray-700 mb-1" style="font-size: 12px;">김세현 차장 <span class="text-gray-500">(2025/05/13)</span></div>
                  <p class="text-gray-800 leading-relaxed" style="font-size: 12px;">신규 위촉 시 보험설계사와 면담을 필수로 진행하세요.</p>
                </div>
                <div class="text-gray-500 toggle-on-yes hidden" style="font-size: 12px;">해당 없음</div>
              </td>
              <td class="px-3 py-3">
                <div class="py-1 improve-box border-l-4 border-gray-200 bg-gray-50 toggle-on-no">
                  <div class="mt-2 flex justify-center">
                    <button class="px-3 py-1.5 primary-blue text-white rounded text-xs improvement-open-btn" data-target="details-r2">작성/확인</button>
                  </div>
                </div>
                <div class="text-gray-500 toggle-on-yes hidden" style="font-size: 12px;">해당 없음</div>
              </td>
              <!-- 조치 열 제거: 버튼을 개선사항 셀로 이동합니다. -->
            </tr>
            <!-- Row 2 details (예: 비활성) -->
            <tr id="details-r2" class="hidden" aria-hidden="true">
              <td colspan="7" class="bg-blue-50 px-4 py-4">
                <div class="space-y-3 details-content"></div>
              </td>
            </tr>

            <!-- Row 3 -->
            <tr class="table-row hover:bg-gray-50 transition-colors" data-row-id="r3">
              <td class="px-4 py-4 text-gray-800 cell-truncate" style="font-size: 12px;"><div class="truncate" title="1. 보험설계사관리 부문">1. 보험설계사관리 부문</div></td>
              <td class="px-4 py-4 text-gray-800 cell-truncate" style="font-size: 12px;"><div class="truncate" title="(3) 보험설계사관리 감독">(3) 보험설계사관리 감독</div></td>
              <td class="px-4 py-4 text-gray-800" data-role="question" style="font-size: 12px;"><div class="leading-relaxed cursor-pointer">불완전판매 방지를 위해 상품 설명서 교부 및 핵심설명확인서를 필수로 징구하고 있는가?</div></td>
              <td class="px-4 py-4 text-gray-800 text-center cell-truncate" style="font-size: 12px;"><span class="inline-flex items-center px-3 py-1 rounded font-medium" style="background-color: #E8F5E8; color: #2E7D32; border: 1px solid #C8E6C9; font-size: 12px;">예</span></td>
              <td class="px-3 py-3"><div class="text-gray-800" style="font-size:12px;">위해촉 기준을 재대로 안내하지 않음</div></td>
              <td class="px-3 py-3">
                <div class="pl-2 py-1 border-l-4 border-orange-400 bg-orange-50 toggle-on-no">
                  <div class="text-gray-700 mb-1" style="font-size: 12px;">정해인 이사 <span class="text-gray-500">(2025/05/12)</span></div>
                  <p class="text-gray-800 leading-relaxed" style="font-size: 12px;">AS 응대 프로세스 개선이 필요합니다.</p>
                </div>
                <div class="text-gray-500 toggle-on-yes hidden" style="font-size: 12px;">해당 없음</div>
              </td>
              <td class="px-3 py-3">
                <div class="py-1 min-h-[60px] border-l-4 border-blue-400 bg-blue-50 toggle-on-no">
                  <div class="mt-2 flex justify-center">
                    <button class="px-3 py-1.5 primary-blue text-white rounded text-xs improvement-open-btn" data-target="details-r3">작성/확인</button>
                  </div>
                </div>
                <div class="text-gray-500 toggle-on-yes hidden" style="font-size: 12px;">해당 없음</div>
              </td>
              <!-- 조치 열 제거 -->
            </tr>
            <tr id="details-r3" class="hidden" aria-hidden="true"><td colspan="7" class="bg-blue-50 px-4 py-4"><div class="space-y-3 details-content"></div></td></tr>

            <!-- Row 4 -->
            <tr class="table-row hover:bg-gray-50 transition-colors" data-row-id="r4">
              <td class="px-4 py-4 text-gray-800 cell-truncate" style="font-size: 12px;"><div class="truncate" title="1. 보험설계사관리 부문">1. 보험설계사관리 부문</div></td>
              <td class="px-4 py-4 text-gray-800 cell-truncate" style="font-size: 12px;"><div class="truncate" title="(4) 비가동설계사관리">(4) 비가동설계사관리</div></td>
              <td class="px-4 py-4 text-gray-800" data-role="question" style="font-size: 12px;"><div class="leading-relaxed cursor-pointer">모집인 변경·해촉 시 고객 안내 및 관련 전산 반영이 지연 없이 수행되고 있는가?</div></td>
              <td class="px-4 py-4 text-gray-800 text-center cell-truncate" style="font-size: 12px;"><span class="inline-flex items-center px-3 py-1 rounded font-medium" style="background-color: #FFE6E6; color: #D32F2F; border: 1px solid #FFCDD2; font-size: 12px;">아니오</span></td>
              <td class="px-3 py-3"><div class="text-gray-800" style="font-size:12px;">위해촉 기준을 재대로 안내하지 않음</div></td>
              <td class="px-3 py-3">
                <div class="pl-2 py-1 border-l-4 border-orange-400 bg-orange-50 toggle-on-no">
                  <div class="text-gray-700 mb-1" style="font-size: 12px;">최동욱 차장 <span class="text-gray-500">(2025/05/14)</span></div>
                  <p class="text-gray-800 leading-relaxed" style="font-size: 12px;">계약 체결리스트를 준수하고 활동 중인 보험설계사를 파악하세요.</p>
                </div>
                <div class="text-gray-500 toggle-on-yes hidden" style="font-size: 12px;">해당 없음</div>
              </td>
              <td class="px-3 py-3">
                <div class="py-1 min-h-[60px] border-l-4 border-gray-200 bg-gray-50 toggle-on-no">
                    <div class="mt-2 flex justify-center">
                      <button class="px-3 py-1.5 primary-blue text-white rounded text-xs improvement-open-btn" data-target="details-r4">작성/확인</button>
                    </div>
                </div>
                <div class="text-gray-500 toggle-on-yes hidden" style="font-size: 12px;">해당 없음</div>
              </td>
            </tr>
            <!-- Row 4 details -->
            <tr id="details-r4" class="hidden" aria-hidden="true">
              <td colspan="7" class="bg-blue-50 px-4 py-4">
                <div class="space-y-3 details-content"></div>
              </td>
            </tr>

            <!-- Row 5 -->
            <tr class="table-row hover:bg-gray-50 transition-colors" data-row-id="r5">
              <td class="px-4 py-4 text-gray-800 cell-truncate" style="font-size: 12px;"><div class="truncate" title="2. 불완전판매 사전예방 및 민원관리 부문">2. 불완전판매 사전예방 및 민원관리 부문</div></td>
              <td class="px-4 py-4 text-gray-800 cell-truncate" style="font-size: 12px;"><div class="truncate" title="(1) 보험상품 설명">(1) 보험상품 설명</div></td>
              <td class="px-4 py-4 text-gray-800" data-role="question" style="font-size: 12px;"><div class="leading-relaxed cursor-pointer">민원 발생 시 원인분석 및 재발방지 대책을 수립하여 전사 공유하고 있는가?</div></td>
              <td class="px-4 py-4 text-gray-800 text-center cell-truncate" style="font-size: 12px;"><span class="inline-flex items-center px-3 py-1 rounded font-medium" style="background-color: #E8F5E8; color: #2E7D32; border: 1px solid #C8E6C9; font-size: 12px;">예</span></td>
              <td class="px-3 py-3"><div class="text-gray-800" style="font-size:12px;">위해촉 기준을 재대로 안내하지 않음</div></td>
              <td class="px-3 py-3">
                <div class="pl-2 py-1 border-l-4 border-orange-400 bg-orange-50 toggle-on-no">
                  <div class="text-gray-700 mb-1" style="font-size: 12px;">한지우 부장 <span class="text-gray-500">(2025/05/13)</span></div>
                  <p class="text-gray-800 leading-relaxed" style="font-size: 12px;">신규 허용시 보험설계사의 면담 기록이 미흡합니다.</p>
                </div>
                <div class="text-gray-500 toggle-on-yes hidden" style="font-size: 12px;">해당 없음</div>
              </td>
              <td class="px-3 py-3">
                <div class="py-1 min-h-[60px] border-l-4 border-blue-400 bg-blue-50 toggle-on-no">
                  <div class="mt-2 flex justify-center">
                    <button class="px-3 py-1.5 primary-blue text-white rounded text-xs improvement-open-btn" data-target="details-r5">작성/확인</button>
                  </div>
                </div>
                <div class="text-gray-500 toggle-on-yes hidden" style="font-size: 12px;">해당 없음</div>
              </td>
            </tr>
            <tr id="details-r5" class="hidden" aria-hidden="true"><td colspan="7" class="bg-blue-50 px-4 py-4"><div class="space-y-3 details-content"></div></td></tr>
          </tbody>
        </table>
      </div>
      <!-- 하단 통합 제출 버튼 -->
    </div>
    <div class="flex justify-end mt-3">
      <button id="submit-all" type="button" class="px-6 py-3 primary-blue text-white rounded font-medium" style="font-size: 12px;">제출(완료)</button>
    </div>
  </div>

  <script>
    // B타입: '아니오' 행만 확장 패널로 작성/저장 UX
    document.addEventListener('DOMContentLoaded', function () {
      function buildDetailsFromRow(row, panel) {
        // 이미 구성되었으면 스킵
        if (panel.getAttribute('data-initialized') === 'true') return;
  const questionCell = row.querySelector('td[data-role="question"] .leading-relaxed');
        const questionText = questionCell ? questionCell.textContent.trim() : '';
  const feedbackEl = row.querySelector('td:nth-child(6) .toggle-on-no p');
        const feedbackText = feedbackEl ? feedbackEl.textContent.trim() : '해당 없음';
  const improvementEl = row.querySelector('td [data-field="improvement"]');
        const improvementTextRaw = improvementEl ? (improvementEl.value || improvementEl.textContent || '').trim() : (row.dataset.improvement || '');
  const dueDateEl = row.querySelector('td [data-field="dueDate"]');
        let dueDateValueRaw = '';
        if (dueDateEl) {
          dueDateValueRaw = (dueDateEl.value || dueDateEl.getAttribute('value') || '').trim();
        } else {
          dueDateValueRaw = (row.dataset.dueDate || '').trim();
        }
        const improvementText = improvementTextRaw;
        const dueDateValue = dueDateValueRaw;
        const hasFeedback = !!(feedbackText && feedbackText !== '해당 없음');
        const hasImprovement = !!improvementText;
        const hasDueDate = !!dueDateValue;

        const container = panel.querySelector('.details-content') || panel;
        const badge = (label, ok) => `
          <span class="inline-flex items-center px-2 py-0.5 rounded text-[11px] border ${ok ? 'bg-green-50 text-green-700 border-green-200' : 'bg-gray-50 text-gray-500 border-gray-200'}">
            ${label} ${ok ? '지정됨' : '미지정'}
          </span>`;

        container.innerHTML = `
          <div class="text-xs text-gray-900 bg-white border border-blue-200 rounded p-3">${questionText}</div>
          <div>
            <div class="text-xs text-gray-600 mb-1">승인자 피드백</div>
            <div class="text-xs text-gray-800 bg-white border border-blue-200 rounded p-3">${feedbackText}</div>
          </div>
          <div class="flex flex-wrap gap-2">${badge('피드백', hasFeedback)}${badge('개선사항', hasImprovement)}${badge('완료예정일', hasDueDate)}</div>
          <div>
            <label class="text-xs text-gray-600 mb-1 block">개선사항 작성</label>
            <textarea rows="4" class="w-full border border-blue-300 rounded p-2 text-xs focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="개선사항을 입력하세요" data-field="panel-improvement">${improvementText}</textarea>
          </div>
          <div>
            <label class="text-xs text-gray-600 mb-1 block">완료예정일</label>
            <input type="date" class="w-full border border-blue-300 rounded px-2 py-1.5 text-xs focus:ring-2 focus:ring-blue-500 focus:border-transparent" data-field="panel-dueDate" value="${dueDateValue}" />
          </div>
          <div class="flex justify-end gap-2">
            <button class="px-3 py-1.5 bg-gray-200 text-gray-800 rounded text-xs close-btn" data-target="${panel.id}">닫기</button>
            <button class="px-3 py-1.5 bg-green-600 text-white rounded text-xs save-btn" data-target="${panel.id}">저장</button>
          </div>
        `;
        panel.setAttribute('data-initialized', 'true');
      }

      function togglePanel(row, button) {
        const rowId = row.getAttribute('data-row-id');
        const targetId = `details-${rowId}`;
        const panel = document.getElementById(targetId);
        const expanded = panel.classList.contains('hidden') === false;
        if (button) button.setAttribute('aria-expanded', String(expanded ? false : true));
        panel.classList.toggle('hidden', expanded);
        panel.setAttribute('aria-hidden', String(expanded));
        if (!expanded) {
          buildDetailsFromRow(row, panel);
          const firstInput = panel.querySelector('textarea, input[type="date"]');
          firstInput && firstInput.focus();
        }
      }

      // 개선사항/수정/행 중앙 버튼 등 모든 opener 버튼을 처리
      document.addEventListener('click', (e) => {
        const target = e.target;
        if (target.matches('.improvement-open-btn, .improvement-edit-btn, .row-open-btn')) {
          const targetId = target.getAttribute('data-target');
          const rowId = targetId ? targetId.replace('details-', '') : null;
          const row = rowId ? document.querySelector(`tr[data-row-id="${rowId}"]`) : null;
          if (row) togglePanel(row, target);
        }
      });

      // 질문 텍스트 클릭으로도 패널을 여는 동작 유지
      document.querySelectorAll('tr[data-row-id] td[data-role="question"] .leading-relaxed').forEach((el) => {
        el.addEventListener('click', () => {
          const row = el.closest('tr[data-row-id]');
          const openBtn = row.querySelector('.improvement-open-btn, .row-open-btn');
          if (openBtn) togglePanel(row, openBtn);
        });
      });

      // 이벤트 위임: 동적으로 생성된 닫기 버튼 처리
      document.addEventListener('click', (e) => {
        const target = e.target;
        if (target.matches('.close-btn')) {
          const targetId = target.getAttribute('data-target');
          const panel = document.getElementById(targetId);
          // 여러 종류의 opener 버튼에서 data-target으로 찾음
          const opener = document.querySelector(`.row-open-btn[data-target="${targetId}"], .improvement-open-btn[data-target="${targetId}"], .improvement-edit-btn[data-target="${targetId}"]`);
          panel.classList.add('hidden');
          panel.setAttribute('aria-hidden', 'true');
          opener?.setAttribute('aria-expanded', 'false');
          opener?.focus();
        }
      });

      // 초기 렌더 시, 각 행의 입력 UI를 숨기고 상태 배지로 치환
      function renderRowBadges(row) {
  const feedbackTextEl = row.querySelector('td:nth-child(6) .toggle-on-no p');
        const feedbackText = feedbackTextEl ? feedbackTextEl.textContent.trim() : '';
  const improvementEl = row.querySelector('td [data-field="improvement"]');
  const improvementText = improvementEl ? (improvementEl.value || improvementEl.textContent || '').trim() : (row.dataset.improvement || '');
  const dueDateEl = row.querySelector('td [data-field="dueDate"]');
        let dueDateValue = '';
        if (dueDateEl) {
          dueDateValue = (dueDateEl.value || dueDateEl.getAttribute('value') || '').trim();
        } else {
          dueDateValue = (row.dataset.dueDate || '').trim();
        }
        // 데이터셋 동기화
        row.dataset.improvement = improvementText || '';
        row.dataset.dueDate = dueDateValue || '';
        const hasFeedback = !!(feedbackText && feedbackText !== '해당 없음');
        const hasImprovement = !!improvementText;
        const hasDueDate = !!dueDateValue;
        const badge = (label, ok) => `
          <span class="inline-flex items-center px-2 py-0.5 rounded text-[11px] border ${ok ? 'bg-green-50 text-green-700 border-green-200' : 'bg-gray-50 text-gray-500 border-gray-200'}">${label} ${ok ? '지정됨' : '미지정'}</span>`;

          // 개선사항 셀
          const improvementCell = improvementEl ? improvementEl.closest('td') : row.querySelector('td:nth-child(7)');
          const rowId = row.getAttribute('data-row-id');
          if (improvementCell) {
            const existing = row.dataset.improvement || '';
            if (existing) {
              // 개선사항이 이미 작성된 경우: 가운데 정렬된 태그 + 수정 버튼 표시
              improvementCell.innerHTML = `
                <div class="improvement-button-wrap"> 
                  <span class="inline-block text-xs px-2 py-0.5 bg-green-50 text-green-700 border border-green-200 rounded">개선사항 작성 완료</span>
                  <button class="ml-2 px-2 py-0.5 text-xs bg-white border rounded improvement-edit-btn" data-target="details-${rowId}">수정</button>
                </div>
              `;
            } else {
              // 미작성 항목은 가운데 정렬된 버튼만 표시
              improvementCell.innerHTML = `
                <div class="improvement-button-wrap"> 
                  <button class="px-3 py-1.5 primary-blue text-white rounded text-xs improvement-open-btn" data-target="details-${rowId}">작성/확인</button>
                </div>
              `;
            }
          }

          // 완료예정일 컬럼을 표에서 제거했으므로 테이블에 날짜를 렌더링하지 않습니다.

          // 담당자 열을 제거했으므로 별도 actionCell은 삽입하지 않습니다.
      }

      document.querySelectorAll('tr[data-row-id]').forEach(renderRowBadges);

      // 저장 처리: 패널 입력 → 행 데이터셋 반영 → 배지(표) 갱신
      document.addEventListener('click', (e) => {
        const target = e.target;
        if (target.matches('.save-btn')) {
          const targetId = target.getAttribute('data-target');
          const panel = document.getElementById(targetId);
          const rowId = targetId.replace('details-', '');
          const row = document.querySelector(`tr[data-row-id="${rowId}"]`);
          const improvement = panel.querySelector('[data-field="panel-improvement"]');
          const dueDate = panel.querySelector('[data-field="panel-dueDate"]');
          const improvementVal = (improvement.value || '').trim();
          const dueDateVal = (dueDate.value || '').trim();
          if (!improvementVal) { alert('개선사항을 입력하세요.'); improvement.focus(); return; }
          if (!dueDateVal) { alert('완료예정일을 선택하세요.'); dueDate.focus(); return; }
          row.dataset.improvement = improvementVal;
          row.dataset.dueDate = dueDateVal;
          renderRowBadges(row);
          // 패널 닫기 및 저장 상태 표시
          const opener = document.querySelector(`.row-open-btn[data-target="${targetId}"], .improvement-open-btn[data-target="${targetId}"], .improvement-edit-btn[data-target="${targetId}"]`);
          const panelEl = document.getElementById(targetId);
          panelEl.classList.add('hidden');
          panelEl.setAttribute('aria-hidden', 'true');
          opener?.focus();
          target.textContent = '저장됨';
          target.classList.remove('bg-green-600','hover:bg-green-700');
          target.classList.add('bg-green-700');
        }
      });
    });
  </script>
</body>
</html>


